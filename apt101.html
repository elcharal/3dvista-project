<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartment 101 Details</title>
    <style>
        /* Basic styling for the popup content */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ensures content fills the iframe */
        }
        .container {
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            max-width: 400px; /* Adjust as needed */
            width: 90%;
            box-sizing: border-box; /* Include padding in width */
        }
        h3 {
            color: #333;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        p {
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        strong {
            color: #555;
        }
        span {
            font-weight: bold;
        }
        .status-sold { color: red; }
        .status-available { color: green; }
        .status-reserved { color: orange; }
        #tour-error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h3>Apartment 101 Details</h3>
        <p>
            <strong>Status:</strong> <span id="apt101-status">Loading...</span>
        </p>
        <p>
            <strong>Price:</strong> <span id="apt101-price">Loading...</span>
        </p>
        <p>
            <strong>Notes:</strong> <span id="apt101-notes">Loading...</span>
        </p>
        <div id="tour-error-message"></div>
    </div>

    <script>
    // --- Configuration ---
    const API_URL = 'https://script.google.com/macros/s/AKfycbwNsaqHEHmENxLPHipOMMjw5xheqz2wxUyWIz48hbSu7Vck6pHGxmZUgNIP3erIYYrg/exec'; // <--- IMPORTANT: Paste your UNIQUE Google Apps Script Web App URL here!
    const APARTMENT_ID_TO_FETCH = 'APT_101'; // <--- IMPORTANT: This MUST match the 'apartment_id' in your Google Sheet for this specific apartment.

    // --- Function to Fetch and Update Data for a Single Apartment ---
    async function updateApartmentData() {
        console.log(`Fetching data for ${APARTMENT_ID_TO_FETCH}...`);
        try {
            const response = await fetch(API_URL);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const allApartments = await response.json(); // Get all data from your sheet
            console.log('All data fetched:', allApartments);

            // Find the specific apartment data by ID
            const apartment = allApartments.find(apt => apt.apartment_id === APARTMENT_ID_TO_FETCH);

            if (apartment) {
                const status = apartment.status;
                const price = apartment.price;
                const notes = apartment.notes;

                // Update Status
                const statusElement = document.getElementById('apt101-status');
                if (statusElement) {
                    statusElement.textContent = status;
                    // Remove previous status classes and add new one
                    statusElement.classList.remove('status-sold', 'status-available', 'status-reserved');
                    if (status === 'Sold') {
                        statusElement.classList.add('status-sold');
                    } else if (status === 'Available') {
                        statusElement.classList.add('status-available');
                    } else if (status === 'Reserved') {
                        statusElement.classList.add('status-reserved');
                    }
                } else {
                    console.warn(`Status element 'apt101-status' not found.`);
                }

                // Update Price
                const priceElement = document.getElementById('apt101-price');
                if (priceElement) {
                    const formattedPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(price);
                    priceElement.textContent = formattedPrice;
                } else {
                    console.warn(`Price element 'apt101-price' not found.`);
                }

                // Update Notes
                const notesElement = document.getElementById('apt101-notes');
                if (notesElement) {
                    notesElement.textContent = notes; // No "Notes: " prefix here, let the strong tag handle it in HTML
                } else {
                    console.warn(`Notes element 'apt101-notes' not found.`);
                }

            } else {
                console.warn(`Apartment with ID '${APARTMENT_ID_TO_FETCH}' not found in the data.`);
                const errorDisplayElement = document.getElementById('tour-error-message');
                if (errorDisplayElement) {
                    errorDisplayElement.textContent = `Error: Data for ${APARTMENT_ID_TO_FETCH} not found. Please check Google Sheet ID or data.`;
                }
            }

        } catch (error) {
            console.error('Error updating apartment data:', error);
            const errorDisplayElement = document.getElementById('tour-error-message');
            if (errorDisplayElement) {
                errorDisplayElement.textContent = 'Failed to load apartment data. Please check your internet connection or API URL.';
            }
        }
    }

    // --- Trigger the update when the popup loads ---
    // Ensure the DOM is fully loaded before trying to access elements
    document.addEventListener('DOMContentLoaded', updateApartmentData);

    // If the popup might load content after DOMContentLoaded fires (e.g., in an iframe context)
    // you might need to call updateApartmentData() directly at the end of the script,
    // or check 3D Vista's documentation for specific iframe load events.
    // For most cases, DOMContentLoaded is good practice for general web pages.
    </script>
</body>
</html>